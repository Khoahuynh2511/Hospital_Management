<UserControl x:Class="LTTQ_DoAn.View.Queue"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewModel="clr-namespace:LTTQ_DoAn.ViewModel"
             xmlns:local="clr-namespace:LTTQ_DoAn.View"
             mc:Ignorable="d" 
             xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
             Background="Transparent"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             d:DesignHeight="644" d:DesignWidth="1049">
    <UserControl.DataContext>
        <viewModel:QueueViewModel/>
    </UserControl.DataContext>
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>
    <Border CornerRadius="20" Background="White">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="60"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!--Current number display-->
            <Border Background="{StaticResource headerGradient}" CornerRadius="15" Margin="25 20" Padding="30 25">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="5" BlurRadius="15" Opacity="0.3" Direction="270"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="ĐANG GỌI SỐ" FontSize="16" Foreground="#FFFFFF" FontWeight="SemiBold" Opacity="0.9"/>
                        <TextBlock Text="{Binding CurrentNumber}" FontSize="72" Foreground="White" FontWeight="Bold" Margin="0 -5 0 0"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Command="{Binding RefreshCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="White"
                            Foreground="{StaticResource btnActivedText}"
                            Height="60" Padding="20 0" Margin="0 0 10 0"
                            ToolTip="Làm mới"
                            materialDesign:ShadowAssist.ShadowDepth="Depth2">
                            <fa:IconImage Icon="Refresh" Height="22" Foreground="{StaticResource btnActivedText}"/>
                        </Button>
                        <Button Command="{Binding CallNextCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="White"
                            Foreground="{StaticResource btnActivedText}"
                            Height="60" Padding="30 0"
                            Visibility="{Binding CallNextVisibility, Converter={StaticResource BoolToVisibilityConverter}}"
                            materialDesign:ShadowAssist.ShadowDepth="Depth2">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconImage Icon="Forward" Height="22" Foreground="{StaticResource btnActivedText}" Margin="0 0 12 0"/>
                                <TextBlock Text="GỌI TIẾP" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!--Search and add bar-->
            <Border Grid.Row="1" BorderBrush="{StaticResource buttonText}" BorderThickness="0 0 0 1" Padding="20 0">
                <Grid VerticalAlignment="Center">
                    <TextBlock Text="Hàng đợi bệnh nhân" FontSize="18" FontWeight="SemiBold" 
                               Foreground="{StaticResource btnActivedText}" VerticalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Border Background="#F5F5F5" CornerRadius="8" Padding="10 5" Margin="0 0 15 0">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconImage Icon="Search" Height="16" Foreground="#757575" Margin="0 0 8 0"/>
                                <TextBox Style="{StaticResource loginTextBox}"
                                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                    CaretBrush="Black" Panel.ZIndex="1" MinWidth="200" BorderThickness="0" Background="Transparent"
                                    ToolTip="Tìm kiếm theo tên, mã bệnh nhân, số thứ tự"
                                    materialDesign:HintAssist.Hint="Tìm kiếm..."/>
                            </StackPanel>
                        </Border>
                        <Button Command="{Binding AddToQueueCommand}"
                            Style="{StaticResource BtnUserControl}"
                            Visibility="{Binding AddVisibility, Converter={StaticResource BoolToVisibilityConverter}}"
                            Padding="15 8">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconImage Icon="UserPlus" Height="14" Margin="0 0 8 0" Foreground="White"/>
                                <TextBlock Text="Thêm vào hàng đợi" FontWeight="SemiBold" Foreground="White"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!--Queue list-->
            <DataGrid x:Name="QueueList" Grid.Row="2"
                      VerticalAlignment="Top" Margin="10"
                      Style="{DynamicResource DataGridStyle1}"
                      CellStyle="{DynamicResource DataGridCellStyle1}"
                      RowStyle="{DynamicResource DataGridRowStyle1}"
                      ItemsSource="{Binding QueueList}"
                      SelectedItem="{Binding SelectedItem}"
                      Height="Auto">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="STT" Width="10*" IsReadOnly="True" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource btnActivedText}" CornerRadius="20" 
                                        Width="40" Height="40" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding SoThuTu}" Foreground="White" FontWeight="Bold" 
                                               FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Mã bệnh nhân" Width="12*" 
                                        Binding="{Binding MaBenhNhanDisplay}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTextColumn Header="Tên bệnh nhân" Width="25*" 
                                        Binding="{Binding TenBenhNhan}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTextColumn Header="Số điện thoại" Width="15*" 
                                        Binding="{Binding SoDienThoai}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTextColumn Header="Thời gian" Width="12*" 
                                        Binding="{Binding ThoiGianDangKy, StringFormat='HH:mm'}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTemplateColumn Header="Trạng thái" Width="14*"
                                            IsReadOnly="True" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="5" Padding="10 5" HorizontalAlignment="Left">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#FFF3E0"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Dang kham">
                                                    <Setter Property="Background" Value="#E3F2FD"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Da kham">
                                                    <Setter Property="Background" Value="#E8F5E9"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding TrangThaiDisplay}" FontSize="12">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="#E65100"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Dang kham">
                                                        <Setter Property="Foreground" Value="#1565C0"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Da kham">
                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Thao tác" Width="12*"
                         IsReadOnly="True" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Command="{Binding DataContext.CompleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="36" Height="36" Margin="2"
                                        ToolTip="Hoàn thành khám">
                                        <fa:IconImage Icon="Check" Height="16" Foreground="{StaticResource successColor}"/>
                                    </Button>
                                    <Button Command="{Binding DataContext.CancelCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="36" Height="36" Margin="2"
                                        ToolTip="Hủy lượt khám">
                                        <fa:IconImage Icon="Xmark" Height="16" Foreground="{StaticResource dangerColor}"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Border>
</UserControl>
