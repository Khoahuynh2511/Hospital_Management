<UserControl x:Class="LTTQ_DoAn.View.Invoice"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewModel="clr-namespace:LTTQ_DoAn.ViewModel"
             xmlns:local="clr-namespace:LTTQ_DoAn.View"
             mc:Ignorable="d" 
             xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
             Background="Transparent"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             d:DesignHeight="644" d:DesignWidth="1049">
    <UserControl.DataContext>
        <viewModel:InvoiceViewModel></viewModel:InvoiceViewModel>
    </UserControl.DataContext>
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>
    <Border CornerRadius="20" Background="White">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="60"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!--Thống kê hóa đơn-->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="15 20 15 10">
                <!--Doanh thu hôm nay-->
                <Border Background="{StaticResource cardRevenueBg}" CornerRadius="15" Padding="25 20" Margin="15 0" MinWidth="220">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="3" BlurRadius="10" Opacity="0.15" Direction="270"/>
                    </Border.Effect>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0 0 0 8">
                            <fa:IconImage Icon="ChartLine" Height="18" Foreground="#2E7D32" Margin="0 0 8 0"/>
                            <TextBlock Text="DOANH THU HÔM NAY" FontWeight="SemiBold" FontSize="11" Foreground="#2E7D32" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding TodayTotalFormatted}" FontSize="24" FontWeight="Bold" Foreground="#1B5E20"/>
                    </StackPanel>
                </Border>
                
                <!--Chưa thanh toán-->
                <Border Background="{StaticResource cardAlertBg}" CornerRadius="15" Padding="25 20" Margin="15 0" MinWidth="180">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="3" BlurRadius="10" Opacity="0.15" Direction="270"/>
                    </Border.Effect>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0 0 0 8">
                            <fa:IconImage Icon="ExclamationTriangle" Height="18" Foreground="#C62828" Margin="0 0 8 0"/>
                            <TextBlock Text="CHƯA THANH TOÁN" FontWeight="SemiBold" FontSize="11" Foreground="#C62828" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding UnpaidCount}" FontSize="32" FontWeight="Bold" Foreground="#B71C1C"/>
                    </StackPanel>
                </Border>
            </StackPanel>
            
            <!--Thanh tìm kiếm-->
            <Border Grid.Row="1" BorderBrush="{StaticResource buttonText}" BorderThickness="0 0 0 1" Padding="20 0">
                <Grid VerticalAlignment="Center">
                    <TextBlock Text="Danh sách hóa đơn" FontSize="18" FontWeight="SemiBold" 
                               Foreground="{StaticResource btnActivedText}" VerticalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Border Background="#F5F5F5" CornerRadius="8" Padding="10 5" Margin="0 0 15 0">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconImage Icon="Search" Height="16" Foreground="Black" Margin="0 0 8 0"/>
                                <TextBox Style="{StaticResource loginTextBox}"
                                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                    Foreground="Black"
                                    CaretBrush="Black" Panel.ZIndex="1" MinWidth="200" BorderThickness="0" Background="Transparent"
                                    ToolTip="Tìm kiếm theo mã hóa đơn, tên bệnh nhân"
                                    materialDesign:HintAssist.Hint="Tìm kiếm..."/>
                            </StackPanel>
                        </Border>
                        <Button Command="{Binding CreateInvoiceCommand}"
                            Style="{StaticResource BtnUserControl}"
                            Visibility="{Binding CreateVisibility, Converter={StaticResource BoolToVisibilityConverter}}"
                            Padding="15 8">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconImage Icon="Plus" Height="14" Margin="0 0 8 0" Foreground="White"/>
                                <TextBlock Text="Tạo hóa đơn" FontWeight="SemiBold" Foreground="White"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!--Danh sách hóa đơn-->
            <DataGrid x:Name="InvoiceList" Grid.Row="2"
                      VerticalAlignment="Top" Margin="10"
                      Style="{DynamicResource DataGridStyle1}"
                      CellStyle="{DynamicResource DataGridCellStyle1}"
                      RowStyle="{DynamicResource DataGridRowStyle1}"
                      ItemsSource="{Binding InvoiceList}"
                      SelectedItem="{Binding SelectedItem}"
                      Height="Auto">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Mã hóa đơn" Width="12*"
                                        IsReadOnly="True" CanUserResize="False"
                                        Binding="{Binding MaHoaDon}"/>

                    <DataGridTextColumn Header="Bệnh nhân" Width="20*" 
                                        Binding="{Binding TenBenhNhan}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTextColumn Header="Ngày lập" Width="12*" 
                                        Binding="{Binding NgayLap, StringFormat='dd/MM/yyyy'}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTextColumn Header="Thành tiền" Width="15*" 
                                        Binding="{Binding ThanhTien, StringFormat='{}{0:N0} VND'}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTextColumn Header="Phương thức" Width="12*" 
                                        Binding="{Binding PhuongThuc}"
                                        IsReadOnly="True" CanUserResize="False"/>

                    <DataGridTemplateColumn Header="Trạng thái" Width="12*"
                                            IsReadOnly="True" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="5" Padding="8 4" HorizontalAlignment="Left">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Đã thanh toán">
                                                    <Setter Property="Background" Value="#E8F5E9"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Chưa thanh toán">
                                                    <Setter Property="Background" Value="#FFEBEE"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding TrangThai}" FontSize="12">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Đã thanh toán">
                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Chưa thanh toán">
                                                        <Setter Property="Foreground" Value="#C62828"/>
                                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Thao tác" Width="20*"
                         IsReadOnly="True" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Command="{Binding DataContext.ViewCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="36" Height="36" Margin="2"
                                        ToolTip="Xem chi tiết">
                                        <fa:IconImage Icon="Eye" Height="16" Foreground="{StaticResource btnActivedText}"/>
                                    </Button>
                                    <Button Command="{Binding DataContext.PayCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Width="36" Height="36" Margin="2"
                                        ToolTip="Xác nhận thanh toán">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignIconButton}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Đã thanh toán">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                        <Setter Property="Opacity" Value="0.5"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                        <fa:IconImage Icon="CheckCircle" Height="16" Foreground="#2E7D32"/>
                                    </Button>
                                    <Button Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="36" Height="36" Margin="2"
                                        ToolTip="Xóa hóa đơn">
                                        <fa:IconImage Icon="Trash" Height="16" Foreground="#C62828"/>
                                    </Button>
                                    <Button Command="{Binding DataContext.PrintCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Width="36" Height="36" Margin="2"
                                        ToolTip="In hóa đơn">
                                        <fa:IconImage Icon="Print" Height="16" Foreground="#1565C0"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Border>
</UserControl>
